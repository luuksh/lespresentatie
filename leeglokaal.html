<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Klassenplattegrond</title>

  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css" />

  <!-- App init (bestaande logica) -->
  <script type="module" src="js/init.js"></script>
</head>
<body>

  <!-- Topbalk: dropdowns links + opdrachtenbalk rechts -->
  <div class="topbar">
    <div class="indeling-knop">
      <select id="indelingSelect">
        <option value="h216">H216</option>
        <option value="u008">U008</option>
        <option value="groepjes">Viertallen</option>
      </select>

      <select id="klasSelect">
        <!-- Wordt automatisch gevuld via JS -->
      </select>
    </div>

    <!-- Opdrachtenbalk (mooi paneel, geen knop-look) -->
    <div class="opdracht-balk is-success">
      <div class="opdracht-tekst">
        <strong>Lees in je leesboek.</strong>
      </div>
    </div>
  </div>

  <!-- Hoofdcontainer met plattegrond en leraarsbureau -->
  <div class="container">
    <div class="grid-wrapper">
      <div class="bureau-rij">
        <div class="leraar-bureau">Bureau leraar</div>
      </div>
      <div class="grid" id="plattegrond">
        <!-- Hier komen de tafels/groepjes dynamisch via JS -->
      </div>
    </div>
  </div>
<script>
(() => {
  // Kies hier de selector die op jouw naamkaartjes past:
  const CARD_SELECTOR = '.seat, .student, .desk-item, .naamkaartje';

  // (optioneel) als je lokaal per lokaal/klas wilt onthouden:
  const roomSel = document.querySelector('select#lokaal, select[name="room"], .room-select');
  const classSel = document.querySelector('select#klas, select[name="class"], .class-select');

  const keyForStorage = () => {
    const r = roomSel?.value || 'room';
    const c = classSel?.value || 'class';
    return `absent_${r}_${c}`;
  };

  // Toggle op klik
  function attachClickToggles() {
    document.querySelectorAll(CARD_SELECTOR).forEach(el => {
      el.addEventListener('click', () => {
        el.classList.toggle('is-absent');
        persist();
      }, { passive: true });
    });
  }

  // Opslaan & herstellen (localStorage)
  function persist() {
    const ids = Array.from(document.querySelectorAll(CARD_SELECTOR))
      .map((el, i) => ({ el, i }))
      .filter(x => x.el.classList.contains('is-absent'))
      .map(x => x.i); // we bewaren de index in de grid
    try { localStorage.setItem(keyForStorage(), JSON.stringify(ids)); } catch {}
  }

  function restore() {
    const raw = localStorage.getItem(keyForStorage());
    if (!raw) return;
    let idxs = [];
    try { idxs = JSON.parse(raw) || []; } catch {}
    const cards = Array.from(document.querySelectorAll(CARD_SELECTOR));
    cards.forEach((el, i) => el.classList.toggle('is-absent', idxs.includes(i)));
  }

  // Als lokaal/klas wisselt: andere set laden
  roomSel?.addEventListener('change', restore);
  classSel?.addEventListener('change', restore);

  // Init
  const init = () => { attachClickToggles(); restore(); };
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else { init(); }
})();
</script>

</body>
</html>
